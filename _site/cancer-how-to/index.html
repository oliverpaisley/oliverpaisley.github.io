<!DOCTYPE html>
<html>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-65908947-1', 'auto');
  ga('send', 'pageview');
</script>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Using R, rCharts, and NVD3 to Visualize Cancer Rates in the US &#8211; Observable Data</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="A breakdown of where to find the cancer data, how to transform it into an applicable format, and how to create and customize interactive visualizations that can be easily shared.">
    <meta name="author" content="Oliver Paisley">
    <meta name="keywords" content="">
    <link rel="canonical" href="http://observabledata.com/cancer-how-to/">
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for Observable Data" href="/feed.xml" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/pixyll.css?201508071919" type="text/css">

    <!-- Fonts -->
    <link href='//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Lato:900,300' rel='stylesheet' type='text/css'>
    
      <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
    


    <!-- Open Graph -->
    <!-- From: https://github.com/mmistakes/hpstr-jekyll-theme/blob/master/_includes/head.html -->
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Using R, rCharts, and NVD3 to Visualize Cancer Rates in the US">
    <meta property="og:description" content="A website dedicated to data visualizations.">
    <meta property="og:url" content="http://observabledata.com/cancer-how-to/">
    <meta property="og:site_name" content="Observable Data">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    
        <meta name="twitter:site" content="@oliverjdpaisley" />
    
    <meta name="twitter:title" content="Using R, rCharts, and NVD3 to Visualize Cancer Rates in the US" />
    <meta name="twitter:description" content="A breakdown of where to find the cancer data, how to transform it into an applicable format, and how to create and customize interactive visualizations that can be easily shared." />
    <meta name="twitter:url" content="http://observabledata.com/cancer-how-to/" />

    <!-- Icons -->
    <link rel="icon" type="image/png" href="/favicon.png">

    
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-65908947-1']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    

</head>

<body class="site">
  <div class="site-wrap">
    <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
      <a href="http://observabledata.com" class="site-title">Observable Data</a>
      <nav class="site-nav">
        <a href="/about/">About</a>

      </nav>
      <div class="clearfix"></div>
  </div>
</header>


    <div class="post p2 p-responsive wrap" role="main">
      <div class="measure">
        <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-65908947-1', 'auto');
  ga('send', 'pageview');
</script>


<div class="post-header mb2">
  <h2>Using R, rCharts, and NVD3 to Visualize Cancer Rates in the US</h2>
</div>
<article class="post-content">
  <p>Our goal is to create an interactive graph of cancer rates in the United States.</p>

<p>There is 12 years worth of data available from the Centers of Disease Control and Prevention, can it can be obtained <a href="http://www.cdc.gov/cancer/npcr/uscs/download_data.htm">here</a>. The data is broken up into multiple files, depending on the variables of interest. We will be using the file <code>BYSITE.txt</code> to compare sites (types of cancer), and the file <code>BYAGE.txt</code> to compare age groups.</p>

<p>After downloading the data, we need to load it into R. We also need to load the packages we will be using. We will be using <a href="https://github.com/hadley/dplyr">dplyr</a> to process the data, <a href="http://rcharts.io/">rCharts</a> to create the graphs, and <a href="https://cran.r-project.org/web/packages/RColorBrewer/RColorBrewer.pdf">RColorBrewer</a> for pretty colors.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span>dplyr<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>rCharts<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>RColorBrewer<span class="p">)</span>

site_data <span class="o">&lt;-</span> read.table<span class="p">(</span><span class="s">&quot;data/BYSITE.TXT&quot;</span><span class="p">,</span>
                        sep <span class="o">=</span> <span class="s">&#39;|&#39;</span><span class="p">,</span>
                        header <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span>
                        stringsAsFactors <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>

age_data  <span class="o">&lt;-</span> read.table<span class="p">(</span><span class="s">&quot;data/BYAGE.TXT&quot;</span><span class="p">,</span>
                        sep <span class="o">=</span> <span class="s">&#39;|&#39;</span><span class="p">,</span>
                        header <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span>
                        stringsAsFactors <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>

<span class="kp">names</span><span class="p">(</span>age_data<span class="p">)</span>  <span class="o">&lt;-</span> <span class="kp">tolower</span><span class="p">(</span><span class="kp">names</span><span class="p">(</span>age_data<span class="p">))</span>
<span class="kp">names</span><span class="p">(</span>site_data<span class="p">)</span> <span class="o">&lt;-</span> <span class="kp">tolower</span><span class="p">(</span><span class="kp">names</span><span class="p">(</span>site_data<span class="p">))</span></code></pre></div>

<p>We now need to transform the data into a format acceptable for rCharts. rCharts connects to JavaScript libraries that utilize <a href="http://d3js.org/">D3.js</a>. The JavaScript library we will be connecting to is <a href="http://nvd3.org/">NVD3</a>.</p>

<p>Our first task is to create a graph where the x-axis is time (1999 to 2011), the y-axis is rate of cancer, and different colored lines represent different types of cancer. Therefore, we want 3 columns: year, cancer rate, and type of cancer. The number of rows will be equal to the number of combinations between year and type of cancer.</p>

<p>Since there are so many types of cancer, we will subset our data to include only the types that are most prevalent (highest rate). It is easy to see that the top 5 cancer types were the same for both 1999 and 2011.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Can change year to 2011 to see how they compare.</span>
site_data <span class="o">%&gt;%</span>
  filter<span class="p">(</span>year       <span class="o">==</span> <span class="s">&quot;1999&quot;</span><span class="p">,</span>
         sex        <span class="o">==</span> <span class="s">&quot;Male and Female&quot;</span><span class="p">,</span>
         race       <span class="o">==</span> <span class="s">&quot;All Races&quot;</span><span class="p">,</span>
         event_type <span class="o">==</span> <span class="s">&quot;Incidence&quot;</span><span class="p">,</span>
         count      <span class="o">!=</span> <span class="s">&quot;~&quot;</span><span class="p">,</span>
         count      <span class="o">!=</span> <span class="s">&quot;-&quot;</span><span class="p">,</span>
         count      <span class="o">!=</span> <span class="s">&quot;.&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  mutate<span class="p">(</span>norm_count <span class="o">=</span> <span class="p">(</span><span class="kp">as.integer</span><span class="p">(</span>count<span class="p">)</span> <span class="o">/</span> <span class="kp">as.integer</span><span class="p">(</span>population<span class="p">))</span> <span class="o">*</span> <span class="m">1e5</span><span class="p">)</span> <span class="o">%&gt;%</span>
  arrange<span class="p">(</span>norm_count<span class="p">)</span> <span class="o">%&gt;%</span>
  select<span class="p">(</span>year<span class="p">,</span> site<span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="kp">tail</span><span class="p">(</span><span class="m">7</span><span class="p">)</span></code></pre></div>

<p>Now it is time to subset based on those 5 cancer types, and also prepare our data for rCharts. We will include “All Cancer Sites Combined” for comparison purposes.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">sites <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;Respiratory System&quot;</span><span class="p">,</span>
           <span class="s">&quot;Digestive System&quot;</span><span class="p">,</span>
           <span class="s">&quot;Prostate&quot;</span><span class="p">,</span>
           <span class="s">&quot;Female Breast&quot;</span><span class="p">,</span>
           <span class="s">&quot;Male Genital System&quot;</span><span class="p">,</span>
           <span class="s">&quot;All Cancer Sites Combined&quot;</span><span class="p">)</span>

c1 <span class="o">&lt;-</span> site_data <span class="o">%&gt;%</span>
 filter<span class="p">(</span>year       <span class="o">!=</span> <span class="s">&quot;2007-2011&quot;</span><span class="p">,</span>
        sex        <span class="o">==</span> <span class="s">&quot;Male and Female&quot;</span><span class="p">,</span>
        race       <span class="o">==</span> <span class="s">&quot;All Races&quot;</span><span class="p">,</span>
        event_type <span class="o">==</span> <span class="s">&quot;Incidence&quot;</span><span class="p">,</span>
        count      <span class="o">!=</span> <span class="s">&quot;~&quot;</span><span class="p">,</span>
        count      <span class="o">!=</span> <span class="s">&quot;-&quot;</span><span class="p">,</span>
        count      <span class="o">!=</span> <span class="s">&quot;.&quot;</span><span class="p">,</span>
        site       <span class="o">%in%</span> sites<span class="p">)</span> <span class="o">%&gt;%</span>
 mutate<span class="p">(</span>norm_count <span class="o">=</span> <span class="p">(</span><span class="kp">as.integer</span><span class="p">(</span>count<span class="p">)</span> <span class="o">/</span> <span class="kp">as.integer</span><span class="p">(</span>population<span class="p">))</span> <span class="o">*</span> <span class="m">1e5</span><span class="p">)</span> <span class="o">%&gt;%</span>
 select<span class="p">(</span>year<span class="p">,</span> site<span class="p">,</span> norm_count<span class="p">)</span></code></pre></div>


</article>









      </div>
    </div>
  </div>

  

</body>
</html>
